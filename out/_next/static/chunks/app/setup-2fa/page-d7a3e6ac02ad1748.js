(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[954],{23489:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>v});var t=r(95155),s=r(12115),i=r(20063),c=r(15239),l=r(3998),n=r(86948),o=r(65142),d=r(76444),m=r(15894),u=r(55867),x=r(35299),f=r(76907),h=r(52769),p=r(65380),g=r(24580);function j(){let e=(0,i.useRouter)(),{toast:a}=(0,m.dj)(),{user:r,authLoading:j,has2FA:v,setIsFullyAuthenticated:N,functions:y}=(0,p.A)(),[w,A]=(0,s.useState)(null),[b,E]=(0,s.useState)(""),[S,_]=(0,s.useState)(""),[C,k]=(0,s.useState)(!0),[F,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{j||r||e.replace("/login")},[j,r,e]),(0,s.useEffect)(()=>{r&&!j&&!1===v&&y&&(async()=>{k(!0);try{let e=(0,g.Qg)(y,"generateTwoFactorSecretAction"),a=(await e()).data;if(!a)throw Error("N\xe3o foi poss\xedvel obter a URI de autentica\xe7\xe3o. Tente recarregar a p\xe1gina.");A(a);let r=await h.toDataURL(a);E(r)}catch(e){a({variant:"destructive",title:"Erro ao Gerar Segredo 2FA",description:(e instanceof Error?e:Error("Erro desconhecido")).message||"Por favor, recarregue a p\xe1gina."})}finally{k(!1)}})()},[r,j,v,a,y]);let T=async t=>{if(t.preventDefault(),!r||!w||!y)return void a({variant:"destructive",title:"Erro",description:"Usu\xe1rio ou segredo 2FA n\xe3o encontrado."});R(!0);try{let t=(0,g.Qg)(y,"verifyAndEnableTwoFactorAction");if((await t({secretUri:w,token:S})).data)a({title:"Configura\xe7\xe3o 2FA Conclu\xedda!",description:"Voc\xea ser\xe1 redirecionado para a p\xe1gina principal."}),localStorage.setItem("2fa-verified-".concat(r.uid),"true"),N(!0),e.push("/simulator");else throw Error("C\xf3digo inv\xe1lido. Tente novamente.")}catch(e){a({variant:"destructive",title:"Erro na Verifica\xe7\xe3o",description:e.message||"N\xe3o foi poss\xedvel verificar o c\xf3digo."})}finally{R(!1)}};return j||r&&void 0===v?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:[(0,t.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Verificando configura\xe7\xe3o de seguran\xe7a..."})]}):C&&!1===v?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:[(0,t.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Gerando configura\xe7\xe3o de seguran\xe7a..."})]}):b||C||!1!==v?!1!==v||C?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:[(0,t.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Aguardando..."})]}):(0,t.jsxs)(n.Zp,{className:"w-full max-w-md",children:[(0,t.jsxs)(n.aR,{className:"text-center",children:[(0,t.jsx)(f.A,{className:"mx-auto h-12 w-12 text-primary"}),(0,t.jsx)(n.ZB,{className:"text-2xl mt-4",children:"Configura\xe7\xe3o de Seguran\xe7a Obrigat\xf3ria"}),(0,t.jsx)(n.BT,{children:"Para proteger sua conta, \xe9 necess\xe1rio configurar a autentica\xe7\xe3o de dois fatores (2FA)."})]}),(0,t.jsxs)("form",{onSubmit:T,children:[(0,t.jsxs)(n.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2 text-sm text-left p-4 bg-secondary/50 rounded-lg",children:[(0,t.jsx)("p",{className:"font-semibold",children:"O que fazer:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Instale um aplicativo autenticador (ex: Google Authenticator, Authy)."}),(0,t.jsx)("li",{children:"No aplicativo, escaneie o QR Code abaixo."}),(0,t.jsx)("li",{children:"Digite o c\xf3digo de 6 d\xedgitos gerado pelo aplicativo para verificar."})]})]}),(0,t.jsx)("div",{className:"flex flex-col items-center gap-4",children:b?(0,t.jsx)(c.default,{src:b,alt:"QR Code para 2FA",width:200,height:200,className:"rounded-lg border shadow-md"}):(0,t.jsx)("div",{className:"h-[200px] w-[200px] flex items-center justify-center",children:(0,t.jsx)(x.A,{className:"h-8 w-8 animate-spin"})})}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(d.J,{htmlFor:"token",children:"C\xf3digo de Verifica\xe7\xe3o"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,t.jsx)(o.p,{id:"token",type:"text",inputMode:"numeric",pattern:"[0-9]{6}",maxLength:6,required:!0,value:S,onChange:e=>_(e.target.value),className:"pl-10 text-center tracking-[0.5em]",placeholder:"_ _ _ _ _ _"})]})]})]}),(0,t.jsx)(n.wL,{className:"flex flex-col gap-4",children:(0,t.jsxs)(l.$,{type:"submit",className:"w-full",disabled:F||6!==S.length,children:[F&&(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Verificar e Salvar"]})})]})]}):(0,t.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)] text-center",children:(0,t.jsx)("p",{className:"text-destructive",children:"N\xe3o foi poss\xedvel gerar a configura\xe7\xe3o. Por favor, recarregue a p\xe1gina."})})}function v(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:(0,t.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"})}),children:(0,t.jsx)(j,{})})}},98985:(e,a,r)=>{Promise.resolve().then(r.bind(r,23489))}},e=>{e.O(0,[58,327,707,611,96,76,358],()=>e(e.s=98985)),_N_E=e.O()}]);