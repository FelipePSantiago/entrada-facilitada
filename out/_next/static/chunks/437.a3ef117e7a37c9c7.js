"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{64437:(e,a,r)=>{r.r(a),r.d(a,{AvailabilityManager:()=>p});var i=r(71983),t=r(45849),s=r(95155),n=r(12115),l=r(15894),d=r(3998),o=r(87270),c=r(36596),u=r(24722),m=r(35299),h=r(65380),v=r(24580);let x=["Dispon\xedvel","Reservado","Vendido","Indispon\xedvel"];function p(e){let{property:a}=e,{toast:r}=(0,l.dj)(),{user:p,functions:j}=(0,h.A)(),[f,g]=(0,n.useState)({}),[A,N]=(0,n.useState)(!1),b=(0,n.useRef)(null),w=(0,n.useMemo)(()=>{var e,r;return(null==(r=a.availability)||null==(e=r.towers)?void 0:e.flatMap(e=>e.floors.flatMap(a=>a.units.map(r=>(0,t._)((0,i._)({},r),{towerName:e.tower,floorName:a.floor})))))||[]},[a.availability]),y=async(e,s)=>{if(!p||!j)return void r({variant:"destructive",title:"❌ Erro de Autentica\xe7\xe3o",description:"Por favor, fa\xe7a login novamente."});g(a=>(0,t._)((0,i._)({},a),{[e]:!0}));try{let i=await p.getIdToken(!0),t=(0,v.Qg)(j,"handleUnitStatusChangeAction");await t({propertyId:a.id,unitId:e,newStatus:s,idToken:i}),r({title:"✅ Status Atualizado!",description:"O status da unidade ".concat(e," foi alterado para ").concat(s,".")})}catch(e){r({variant:"destructive",title:"❌ Erro ao Atualizar",description:e.message||"N\xe3o foi poss\xedvel alterar o status da unidade."})}finally{g(a=>(0,t._)((0,i._)({},a),{[e]:!1}))}},E=async e=>{var i;if(!(null==(i=e.target.files)?void 0:i[0])||!p||!j)return void r({variant:"destructive",title:"❌ Erro de Autentica\xe7\xe3o",description:"Por favor, fa\xe7a login novamente."});N(!0);let t=e.target.files[0];try{let e=new FileReader;e.readAsBinaryString(t);let i=await new Promise((a,r)=>{e.onload=e=>{if(!e.target||"string"!=typeof e.target.result)return r(Error("N\xe3o foi poss\xedvel ler o arquivo."));a(e.target.result)},e.onerror=()=>r(Error("Falha ao ler o arquivo.'"))}),s=await p.getIdToken(!0),n=(0,v.Qg)(j,"updatePropertyAvailabilityAction"),{unitsUpdatedCount:l}=(await n({propertyId:a.id,fileContent:i,idToken:s})).data;r({title:"✅ Disponibilidade Atualizada!",description:"Status de ".concat(l," unidades foram processados.")})}catch(e){r({variant:"destructive",title:"❌ Erro na An\xe1lise da Planilha",description:e.message})}finally{N(!1),b.current&&(b.current.value="")}};return(0,s.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 border-2 border-dashed rounded-lg",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Atualizar em Lote"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:'Envie uma planilha Excel (.xlsx) com as colunas "Unidade" e "Disponibilidade".'})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("input",{type:"file",accept:".xlsx",ref:b,onChange:E,className:"hidden"}),(0,s.jsxs)(d.$,{size:"lg",className:"w-full",onClick:()=>{var e;return null==(e=b.current)?void 0:e.click()},disabled:A,children:[A?(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,s.jsx)(u.A,{className:"mr-2 h-5 w-5"}),A?"Atualizando...":"Carregar Disponibilidade (Excel)"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Gerenciamento Manual"}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto border rounded-md",children:(0,s.jsxs)(o.XI,{children:[(0,s.jsx)(o.A0,{children:(0,s.jsxs)(o.Hj,{children:[(0,s.jsx)(o.nd,{children:"Unidade"}),(0,s.jsx)(o.nd,{children:"Torre/Bloco"}),(0,s.jsx)(o.nd,{children:"Andar"}),(0,s.jsx)(o.nd,{className:"w-[200px]",children:"Status"})]})}),(0,s.jsx)(o.BF,{children:w.map(e=>(0,s.jsxs)(o.Hj,{children:[(0,s.jsx)(o.nA,{children:e.unitNumber}),(0,s.jsx)(o.nA,{children:e.towerName}),(0,s.jsx)(o.nA,{children:e.floorName}),(0,s.jsx)(o.nA,{children:f[e.unitId]?(0,s.jsx)(m.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsxs)(c.l6,{value:e.status,onValueChange:a=>y(e.unitId,a),children:[(0,s.jsx)(c.bq,{children:(0,s.jsx)(c.yv,{})}),(0,s.jsx)(c.gC,{children:x.map(e=>(0,s.jsx)(c.eb,{value:e,children:e},e))})]})})]},e.unitId))})]})})]})]})}}}]);